==========================================
Pololu 3Pi+ Follower ——全量调参说明（超详细版）
==========================================

本文件面向第一次接手项目的同学。
目标：让你不看代码也能知道每个参数是的&调大/调小会发生什么。

Follower的控制由三部分组成：

距离控制（碰撞IR → 逆转速度）

方向控制（直线IR→左右转向）

电机速度控制（PID+前馈）

为了让 Follower 在 Leader 之后稳定跟随，参数需要合理设置。

下面所有参数按模块分类，并说明：

作用

调节大效果（越来越多）

调节小效果（越来越多）

调参风险 & 典型建议

请按顺序阅读。不需要理解代码，只需理解行为。

【一个。 距离控制（bump → 纵向速度控制）】

Follower通过bump IR读取到Leader的红外强度（距离越近→raw越大）。
然后通过sigmoid映射生成纵向速度demand_cs。

其核心控制参数如下：

1. C（sigmoid 中心点 —— 决定跟车距离）

作用：控制车辆“想保持多远的距离”
本质上：raw ≈ C 时，车速 = 速度曲线的中点。

调大（如190 → 200）：

Follower会认为Leader“比实际更近” → 提前节约

跟车距离更大、更安全

弧线时 lineIR 变弱，转向能力变差

变焦近慢半拍

调小（如190 → 170）：

Follower会加速靠得更近

横向转向能力更强

更贴紧Leader，弧线也能跟住

距离太近存在撞车风险

建议范围：170–200
Leader弧线速度快时推荐用更小的值（170–180）。

2. K（sigmoid陡峭度）

作用：控制速度随距离变化的敏感度。

调大（K=30）：

速度曲线更平滑

远距离不猛冲，近距离不急刹

整体比较稳定，但反应慢

调小（K=10–15）：

速度变化非常敏感

更快贴近领导者

原始IR噪声基因被放大 → 可能断裂

建议：15–30
一般不需要调整。

3. V_MAX（理论最大速度）

跟随器纵向作用（理论值）

注意：实际上受到了 PWM_MAX 的限制，因此这里决定了更多的曲线形状。

调大：

有能力跟上更快的领导者

可能导致速度曲线太陡 → 身高

调小：

跟车更稳定

跟不上高速领队

（通常保持250个）

4. SAFE_SLOW（跳变保护速度）

当bump raw从180→320这样跳突然变时（通常是反射光/IR干扰），Follower会强制限速到SAFE_SLOW。

调大（80）：

遇到干扰时间速度仍然偏快

可能不够安全

调小（20–40）：

极安全

领导者突然行动时追随者可能会扩大迟钝

建议：40左右

【B. 方向控制（直线→左右转向）】

Follower通过线传感器的左右读数差值判断Leader左右偏移。
核心流程：
左右差值→辅助→放大→steer_term→作用到左/右轮速度。

5. K_steer（横向转向强度——最关键的参数）

作用：决定车辆转向的强度（steer_term 放大倍数）。

调大（如80）：

左右能力强

可跟住领导者的大幅弧线

高速弯道更准确

容易摆头、摆头

调小（如20）：

行为更稳定但方向反应慢

弧线跟不上 Leader

直线表现很好，但无法真正“紧接着动作”

如果为0（你之前的默认）=转向完全关闭→无法跟随转向

建议范围：40–90

6. deadband_raw（差值死区）

Left IR 与 Right IR 的差值如果太小，会被认为是噪声，因此忽略。

调大（如30）：

小偏移完全无视

稳定但非常迟钝

弧线跟不上

最常见的导致“为什么车不转”的原因

调小（如10）：

一点点差就转向→非常灵敏

方向紧跟着更快 → 弧线效果好

可能有轻微左右微摆

建议：10–15

7.clamp_raw（差值限幅）

对差值进行限制，避免过度转向。

调大（如70–80）：

处理可以更急的弯

但可能会出现大幅造型头

调小（如40）：

更平稳

但急弯角度不够→跟不上弧线



8. N_norm（归一化）

diff_raw / N_norm → diff_norm
实际上是缩放转向的范围。

调大（如150）：

转向整体变弱

弧线更跟不上

调小（如80）：

转向整体增强

轻松抖

通常不动（100）



9. alpha（EMA 激励系数）

EMA：
新 = α * 旧 + (1-α) * 当前

调大（如0.8）：

非常平滑

方向变化偏慢

弧线时可能“慢半拍”

调小（如0.5）：

响应快

更容易站立

对高速弧线更友好

建议：0.5–0.6（弧线情况下）

【C. 【PID+电机控制参数】

这些都属于“保持轮速正确执行”的部分。
通常只需要麻烦。

10. KP_L / KP_R（比例项）

调大：

速度很快

可能振动（嗡嗡声）

弧线可能更容易过冲

调小：

平稳但反应慢

弧线尾部可能脱节

通常你保持现在的价值就可以了。

11. KI（积分）

调大：

更精确的最终速度

长时间后会累积天花板导致震荡

调小：

更稳定

但可能有微小误差（steering会修改）

12.KD（微分）

一般为0。
大部分情况下不需要动。

13. kF（前馈）

调大：

轮子更容易以小速度下转动

起步快

偶然会导致低速过冲

调小：

平稳但低速时可能不动

14. PWM_MAX（输出限制幅度）

调大（60→65）：

跟得上高速领导者

超调风险大

调小（60→50）：

更稳定

跟不上快速领导

【D. 不修改建议的周期】
15.估计周期（20ms）
16. PID周期（40ms）

这两个保持默认即可。

【E. 自动标定（不需要调）】
线左基线 / 线右基线

自动采样30帧生成，无需手动。

【F. 调参最推荐顺序（团队统一流程）】

先调 C
→ 决定跟车距离是否合适

再调整 K_steer
→确保能跟住 Leader 的左右移动

调 deadband_raw
→确保不要“迟钝”

调节 alpha
→ 控制“快 vs 稳”

最后电流PID
→ 振荡震荡、提升细节

必要时调节 PWM_MAX
→ 适应 Leader 的最高速度

【G. 实测非常好用的一套参数（30°弧线专用）】

C = 170~180
K_steer = 80
deadband_raw = 10
alpha = 0.5~0.6
clamp_raw = 70
KP_L ≈ 0.040
KP_R ≈ 0.050
PWM_MAX = 60~65


这套系统已经在实际弧线测试中表现出极稳定，推荐作为默认启动参数。