# 三种Follower跟踪模式对比

## 📁 文件夹结构

```
最终版/
├── Follower/          ⭐ 完整版（Bump + Line）
├── Bump Track/        🔵 纯Bump IR跟踪
└── Line track/        🟢 纯Line IR跟踪
```

---

## 🎯 功能对比表

| 特性 | Follower<br>(完整版) | Bump Track<br>(纯Bump) | Line track<br>(纯Line) |
|------|---------------------|----------------------|----------------------|
| **Bump IR** | ✅ 距离控制 | ✅ 距离控制 | ❌ 不使用 |
| **Line IR** | ✅ 转向控制 | ❌ 不使用 | ✅ 转向控制 |
| **速度控制** | 自适应（根据距离） | 自适应（根据距离） | 固定速度 |
| **转向能力** | ✅ 可转向 | ❌ 不转向 | ✅ 可转向 |
| **直线跟随** | ✅✅✅ | ✅✅ | ✅ |
| **弧线跟随** | ✅✅✅ | ❌ | ✅✅ |
| **距离保持** | ✅✅✅ | ✅✅✅ | ❌ |
| **撞车风险** | 低 | 低 | 高（无距离感应） |
| **脱离风险** | 低 | 高（转弯时） | 中（速度不匹配时） |

---

## 🔧 核心区别

### 1️⃣ Follower（完整版）
**控制逻辑：**
```
200ms时间窗口
├── 前100ms: Bump窗口 → 读取Bump IR → demand_cs
└── 后100ms: Line窗口 → 读取Line IR → steer_term
    └→ demand_L = demand_cs - steer_term
    └→ demand_R = demand_cs + steer_term
```

**特点：**
- ✅ 同时使用两种传感器
- ✅ 距离 + 方向 = 完整跟踪
- ✅ 最佳性能

**关键参数：**
- `C = 150.0f` (Sigmoid中心点)
- `K_steer = 120.0f` (转向强度)
- `deadband_raw = 10`
- `alpha = 0.5f`

---

### 2️⃣ Bump Track（纯Bump）
**控制逻辑：**
```
40ms → 读取Bump IR → demand_cs
    └→ demand_L = demand_cs (两轮相同)
    └→ demand_R = demand_cs (两轮相同)
```

**特点：**
- ✅ 只测试距离控制
- ✅ 简单纯粹
- ❌ 无法转向

**关键参数：**
- `C = 150.0f` (Sigmoid中心点) ⭐
- `K = 20.0f` (Sigmoid陡峭度)

**适用场景：**
- 测试Bump IR性能
- 直线跟随
- 调试距离控制

---

### 3️⃣ Line track（纯Line）
**控制逻辑：**
```
40ms → 读取Line IR → steer_term
    └→ demand_L = BASE_SPEED - steer_term
    └→ demand_R = BASE_SPEED + steer_term
```

**特点：**
- ✅ 只测试转向控制
- ✅ 可以跟随弧线
- ❌ 无距离感应（需手动调速度）

**关键参数：**
- `BASE_SPEED = 150.0f` ⭐⭐⭐ 最关键！
- `K_steer = 120.0f` (转向强度)
- `deadband_raw = 10`
- `alpha = 0.5f`

**适用场景：**
- 测试Line IR性能
- 弧线跟随
- 调试转向控制

---

## 📊 使用建议

### 🔬 调试流程（推荐）

```
第1步: 使用 Bump Track
     └→ 验证Bump IR是否正常工作
     └→ 调整 C 参数，找到合适的跟车距离

第2步: 使用 Line track
     └→ 验证Line IR是否正常工作
     └→ 调整 K_steer 参数，找到合适的转向强度
     └→ 调整 BASE_SPEED 匹配Leader速度

第3步: 使用 Follower（完整版）
     └→ 综合调参，达到最佳效果
```

### 🎓 参数迁移

```
Bump Track的 C → 直接用于 Follower
Line track的 K_steer → 直接用于 Follower
Line track的 BASE_SPEED → 作为 Follower中V_MAX的参考
```

---

## ⚠️ 注意事项

### Bump Track
1. ❌ Leader转弯时会脱离（Follower会直行）
2. ✅ 适合测试距离感应灵敏度
3. ✅ 可以验证Bump IR硬件是否正常

### Line track
1. ⚠️ 必须手动调整BASE_SPEED！
2. ⚠️ 速度过快会撞车
3. ⚠️ 速度过慢会脱离
4. ✅ 适合测试转向响应速度

### Follower（完整版）
1. ✅ 最复杂但最强大
2. ✅ 需要综合调参
3. ✅ 生产环境推荐使用

---

## 📈 性能对比

| 场景 | Follower | Bump Track | Line track |
|------|----------|-----------|-----------|
| 直线跟随 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 30°弧线 | ⭐⭐⭐⭐⭐ | ⭐ (会脱离) | ⭐⭐⭐⭐ |
| 60°弧线 | ⭐⭐⭐⭐ | ⭐ (会脱离) | ⭐⭐⭐ |
| 安全性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ (易撞) |
| 调试难度 | ⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |

---

## 🚀 快速开始

### Bump Track
```cpp
1. 打开 Bump Track/Bump_Track.ino
2. 调整 C = 150.0f (第94行)
3. 上传到Follower
4. 按钮1：Bump标定
5. 按钮2：开始跟踪
```

### Line track
```cpp
1. 打开 Line track/Line_Track.ino
2. ⭐ 调整 BASE_SPEED = 150.0f (第48行) - 最重要！
3. 调整 K_steer = 120.0f (第58行)
4. 上传到Follower
5. 按钮1：Line标定（30帧）
6. 按钮2：开始跟踪
```

### Follower（完整版）
```cpp
1. 打开 Follower/Follower.ino
2. 综合调参（见 follower调参注释.txt）
3. 上传到Follower
4. 按钮1：Bump标定
5. 按钮2：Line标定（30帧）
6. 按钮3：开始跟踪
```

---

## 📝 总结

- **调试/测试** → 使用 Bump Track 或 Line track
- **正式比赛/演示** → 使用 Follower（完整版）
- **性能对比** → 三个版本都测试，分析数据

每个版本都有详细的README.md，包含具体的调参说明！

