==============================================================
  PureLine Version - 纯Line Sensor Leader-Follower系统
==============================================================

版本：1.0
日期：2025-12-01
作者：自动生成

==============================================================
  系统概述
==============================================================

本系统是一个纯Line Sensor的Leader-Follower跟踪系统：
- Leader发射Line Sensor IR (EMIT_PIN = HIGH)
- Follower接收IR信号 (EMIT_PIN = INPUT)
- 使用5个Line传感器进行距离和方向控制
- 内置数据记录功能，输出CSV格式数据

==============================================================
  文件结构
==============================================================

PureLine_Version/
├── README.txt          # 本文件
├── Leader/
│   ├── Leader.ino      # Leader主程序
│   └── *.h             # 头文件
└── Follower/
    ├── Follower.ino    # Follower主程序
    └── *.h             # 头文件

==============================================================
  Leader 功能
==============================================================

1. IR发射模式：
   - EMIT_PIN = HIGH (发射Line Sensor IR)

2. 运动路线：
   - Stage 0: 等待3秒（让Follower准备）
   - Stage 1: 直线前进30cm
   - Stage 2: 弧线运动（半径300mm，左转90度）
   - Stage 3: 停止，输出数据

3. 数据记录：
   - 记录Time, X, Y, Theta
   - 每50ms记录一次
   - 最多150个样本
   - CSV格式输出

==============================================================
  Follower 功能
==============================================================

1. IR接收模式：
   - EMIT_PIN = INPUT (关闭自己的IR，接收Leader的)

2. 传感器使用：
   - 中间3个传感器[1,2,3]平均值 → 距离控制
   - 5个传感器加权平均 → 方向控制

3. 控制逻辑：
   - 距离控制：PID让IR强度保持在目标值
   - 方向控制：左右传感器差值 → 转向量

4. 数据记录：
   - 记录Time, X, Y, Theta, IR_value, Steer
   - 每50ms记录一次
   - 最多150个样本
   - CSV格式输出

==============================================================
  使用步骤
==============================================================

【准备阶段】
1. 分别上传Leader.ino和Follower.ino到两个3Pi+
2. 确保两个机器人的外壳已移除（露出IR传感器）
3. 将Follower放在Leader后方，距离约10-15cm

【运行阶段】
1. 先启动Follower：
   - 打开串口监视器（115200波特率）
   - 按下Button B开始校准
   - 等待校准完成（~5秒）
   - Follower开始等待Leader信号

2. 再启动Leader：
   - Leader会等待3秒
   - 然后开始运动（直线+弧线）
   - Follower检测到信号后开始跟随

3. 实验结束后：
   - 两个机器人都会停止
   - 从串口监视器复制CSV数据
   - 可导入Excel或Python进行分析

==============================================================
  参数调整
==============================================================

【Leader参数】（在Leader.ino中修改）
- STRAIGHT_DISTANCE_MM: 直线距离（默认300mm）
- ARC_RADIUS_MM: 弧线半径（默认300mm）
- ARC_ANGLE_RAD: 转弯角度（默认π/2 = 90度）
- DEMAND_CS: 目标速度（默认-250）

【Follower参数】（在Follower.ino中修改）
- DISTANCE_TARGET: 目标IR值（默认80）
- SIGNAL_THRESHOLD: 信号检测阈值（默认25）
- STEER_GAIN: 方向控制增益（默认0.15）
- DIST_KP/KI/KD: 距离PID参数

【数据记录参数】⚠️ 内存敏感！
- MAX_RESULTS: 最大记录数（默认50，不要超过80！）
- RECORD_INTERVAL_MS: 记录间隔（Leader 150ms，Follower 200ms）
- EXPERIMENT_DURATION_MS: 实验时长（Follower，默认10秒）

⚠️ 内存限制说明：
3Pi+只有2560 bytes动态内存！
float results[50][3] = 50 × 3 × 4 = 600 bytes
如果需要更多数据，请分多次实验，每次记录不同的变量

==============================================================
  CSV数据格式
==============================================================

【Leader输出】（精简版，节省内存）
Sample,X_mm,Y_mm,Theta_rad
0,0.00,0.00,0.0000
1,5.23,-1.02,0.0012
...

【Follower输出】（精简版，节省内存）
Sample,X_mm,Y_mm,Theta_rad
0,0.00,0.00,0.0000
1,4.89,-0.85,0.0008
...

注：时间可通过 Sample × Record_Interval 计算得出

==============================================================
  常见问题
==============================================================

Q: Follower检测不到Leader信号？
A: 检查以下几点：
   1. Leader的EMIT_PIN是否设为HIGH
   2. 两个机器人是否移除了外壳
   3. 距离是否在10-20cm范围内
   4. 降低SIGNAL_THRESHOLD值

Q: Follower跟随不稳定？
A: 调整PID参数：
   1. 减小DIST_KP降低响应速度
   2. 增大DIST_KD增加阻尼
   3. 调整STEER_GAIN改变转向灵敏度

Q: 数据记录不完整？
A: 检查MAX_RESULTS是否足够，或增大RECORD_INTERVAL_MS

==============================================================

